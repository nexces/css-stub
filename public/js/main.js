document.addEventListener('DOMContentLoaded', function () {
    var $container = document.querySelector('.siteHeader');
    var $menuSwitch = document.querySelector('#nav-toggle');
    console.log('menu-collapse :: init');
    $menuSwitch.addEventListener('click', function (e) {
        console.log('menu-collapse :: handling event on #nav-toggle');
        e.preventDefault();
        e.stopPropagation();
        e.stopImmediatePropagation();
        $container.classList.toggle('nav-active');
    }, false);
    document.body.addEventListener('click', function () {
        console.log('menu-collapse :: handling event on body');
        $container.classList.remove('nav-active');
    }, false);
}, false);
var Slider = (function () {
    function Slider(sliderSelector) {
        var _this = this;
        this.nextSlideDelay = 5000;
        this.transition = 'fading';
        this.autoProgress = true;
        this.allReady = false;
        this.heightGuard = function () {
            _this.$slidesContainer.style.height = null;
            _this.$slidesContainer.style.height = _this.$slidesContainer.clientHeight + 'px';
        };
        this.handleHover = function (e) {
            console.debug('Slider::handleHover()');
            if (e.type === 'mouseover') {
                _this.autoProgress = false;
                _this.blockAutoProgress();
            }
            if (e.type === 'mouseout') {
                _this.autoProgress = true;
                _this.resumeAutoProgress();
            }
        };
        this.blockAutoProgress = function () {
            console.debug('Slider::blockAutoProgress()');
            clearTimeout(_this.nextSlideTimeout);
            _this.nextSlideTimeout = 0;
        };
        this.resumeAutoProgress = function () {
            console.debug('Slider::resumeAutoProgress()');
            if (_this.allReady && _this.autoProgress && _this.nextSlideDelay > 0) {
                _this.nextSlideTimeout = setTimeout(_this.loadSlide, _this.nextSlideDelay);
            }
        };
        this.loadSlide = function (num) {
            _this.blockAutoProgress();
            if (!_this.allReady) {
                return false;
            }
            var $current, currentData, $next, nextData, currentNum, nextNum, $currentDot, $nextDot;
            $current = _this.$slider.querySelector('.slide.active');
            if (!num) {
                if (!$current) {
                    $next = _this.$slider.querySelector('.slide.initial');
                }
                else {
                    $next = _this.$slider.querySelector('.slide.active + .slide');
                }
                if (!$next) {
                    $next = _this.$slider.querySelector('.slide:nth-child(1)');
                }
            }
            else {
                $next = _this.$slider.querySelector('.slide:nth-child(' + num + ')');
            }
            nextData = $next.dataset;
            if ($current) {
                $current.classList.remove('active');
                currentData = $current.dataset;
                currentNum = currentData.num || $current.className.match(/slide-(\d+)/)[1];
                if (_this.$dotsContainer) {
                    $currentDot = _this.$dotsContainer.querySelector('.dot:nth-child(' + currentNum + ')');
                    $currentDot.classList.remove('active');
                }
            }
            $next.classList.remove('initial');
            $next.classList.add('active');
            nextNum = nextData.num || $next.className.match(/slide-(\d+)/)[1];
            _this.$slider.className = _this.$slider.className.replace(/slide-(\d+)-active/, '');
            _this.$slider.classList.add('slide-' + nextNum + '-active');
            if (_this.$dotsContainer) {
                $nextDot = _this.$dotsContainer.querySelector('.dot:nth-child(' + nextNum + ')');
                $nextDot.classList.add('active');
            }
            _this.resumeAutoProgress();
        };
        this.arrowClick = function (e) {
            var $next, nextData, num, $arrow = e.target;
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();
            if ($arrow.classList.contains('prev')) {
                $next = _this.$slider.querySelector('.slide + .slide.active');
                if ($next) {
                    $next = $next.previousElementSibling;
                }
                else {
                    $next = _this.$slider.querySelector('.slide:last-of-type');
                }
            }
            if ($arrow.classList.contains('next')) {
                $next = (_this.$slider.querySelector('.slide.active + .slide') || _this.$slider.querySelector('.slide:nth-child(1)'));
            }
            nextData = $next.dataset;
            num = nextData.num || $next.className.match(/slide-(\d+)/)[1];
            _this.loadSlide(num);
        };
        this.dotClick = function (e) {
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();
            var $dot = e.target;
            var dotData = $dot.dataset;
            var num = parseInt(dotData.num || e.target.className.match(/slide-(\d+)/)[1]);
            _this.loadSlide(num);
        };
        this.imgReadyNotification = function (e) {
            var $img = e.target;
            var imgData = $img.dataset;
            imgData.ready = 'true';
            _this.heightGuard();
        };
        this.imgReadyWait = function () {
            var $$img = _this.$slider.querySelectorAll('.slide img[data-ready="false"]');
            if ($$img.length > 0) {
                setTimeout(_this.imgReadyWait, 100);
                _this.$slider.classList.add('waiting');
                return false;
            }
            _this.allReady = true;
            _this.$slider.classList.remove('waiting');
            _this.$slider.classList.add('ready');
            _this.loadSlide();
        };
        console.log('Slider::constructor()');
        this.$slider = document.querySelector(sliderSelector);
        if (!this.$slider) {
            console.warn('Slider::constructor() => no slider found via "%s"', sliderSelector);
            return;
        }
        if (this.$slider.classList.contains('sliding')) {
            this.transition = 'sliding';
        }
        var sliderData = this.$slider.dataset;
        if (sliderData.delay) {
            this.nextSlideDelay = parseInt(sliderData.delay);
        }
        this.$slidesContainer = this.$slider.querySelector('.slides');
        if (!this.$slidesContainer) {
            console.error('Slider::constructor() => Slides should be placed in ".slides" container');
            return;
        }
        this.$$slides = this.$slidesContainer.querySelectorAll('.slide');
        if (this.$$slides.length == 0) {
            console.log('Slider::constructor() => nothing to rotate');
            return;
        }
        this.$dotsContainer = this.$slider.querySelector('.dots');
        if (this.$$slides.length > 1) {
            this.$slider.classList.add('controllable');
        }
        this.$slider.addEventListener('mouseover', this.handleHover, false);
        this.$slider.addEventListener('mouseout', this.handleHover, false);
        if (this.$slider.querySelector('.prev')) {
            this.$slider.querySelector('.prev').addEventListener('click', this.arrowClick, false);
        }
        if (this.$slider.querySelector('.next')) {
            this.$slider.querySelector('.next').addEventListener('click', this.arrowClick, false);
        }
        if (this.transition == 'sliding') {
            this.$slidesContainer.style.width = (this.$$slides.length * 100) + '%';
        }
        for (var i = 0; i < this.$$slides.length; i++) {
            var $slide = this.$$slides[i];
            var slideData = $slide.dataset;
            slideData.num = (i + 1).toString();
            $slide.classList.add('slide-' + slideData.num);
            if (this.$dotsContainer) {
                var $currentDot = document.createElement('span');
                var currentDotData = $currentDot.dataset;
                $currentDot.className = 'dot';
                currentDotData.num = (i + 1).toString();
                $currentDot.classList.add('slide-' + currentDotData.num);
                $currentDot.addEventListener('click', this.dotClick, false);
                this.$dotsContainer.appendChild($currentDot);
            }
            var $$imgs = $slide.querySelectorAll('img');
            for (var i2 = 0; i2 < $$imgs.length; i2++) {
                var $img = $$imgs[i2];
                var imgData = $img.dataset;
                imgData.ready = $img.complete ? 'true' : 'false';
                $img.addEventListener('load', this.imgReadyNotification);
            }
            var $imgSrc = $slide.querySelector('.src');
            if ($imgSrc) {
                $slide.style.backgroundImage = 'url(' + $imgSrc.src + ')';
            }
        }
        this.heightGuard();
        window.addEventListener('resize', this.heightGuard, false);
        this.imgReadyWait();
    }
    return Slider;
}());
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NvdXJjZXMvdHMvbWVudS1jb2xsYXBzZS50cyIsIi4uLy4uL3NvdXJjZXMvdHMvc2xpZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUdBLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxrQkFBa0IsRUFBRTtJQUMxQyxJQUFJLFVBQVUsR0FBaUIsUUFBUSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsQ0FBQztJQUNyRSxJQUFJLFdBQVcsR0FBaUIsUUFBUSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsQ0FBQztJQUN0RSxPQUFPLENBQUMsR0FBRyxDQUFDLHVCQUF1QixDQUFDLENBQUM7SUFDckMsV0FBVyxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxVQUFVLENBQUM7UUFDN0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyxnREFBZ0QsQ0FBQyxDQUFDO1FBQzlELENBQUMsQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUNuQixDQUFDLENBQUMsZUFBZSxFQUFFLENBQUM7UUFDcEIsQ0FBQyxDQUFDLHdCQUF3QixFQUFFLENBQUM7UUFDN0IsVUFBVSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDOUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ1YsUUFBUSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUU7UUFDcEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyx5Q0FBeUMsQ0FBQyxDQUFDO1FBQ3ZELFVBQVUsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQzlDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUNkLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztBQ0hWO0lBY0ksZ0JBQVksY0FBc0I7UUFkdEMsaUJBOE5DO1FBN05XLG1CQUFjLEdBQUcsSUFBSSxDQUFDO1FBR3RCLGVBQVUsR0FBRyxRQUFRLENBQUM7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YSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzlELEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7Z0JBQ1YsTUFBTSxDQUFDLEtBQUssQ0FBQyxlQUFlLEdBQUcsTUFBTSxHQUFHLE9BQU8sQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDO1lBQzlELENBQUM7UUFDTCxDQUFDO1FBRUQsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ25CLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLFdBQVcsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUUzRCxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDeEIsQ0FBQztJQTRITCxhQUFDO0FBQUQsQ0FBQyxBQTlORCxJQThOQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ3JlYXRlZCBieSBhZHJpYW5wIG9uIDMwLjA2LjE1LlxuICovXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgZnVuY3Rpb24gKCkge1xuICAgIHZhciAkY29udGFpbmVyID0gPEhUTUxFbGVtZW50PiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2l0ZUhlYWRlcicpO1xuICAgIHZhciAkbWVudVN3aXRjaCA9IDxIVE1MRWxlbWVudD4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI25hdi10b2dnbGUnKTtcbiAgICBjb25zb2xlLmxvZygnbWVudS1jb2xsYXBzZSA6OiBpbml0Jyk7XG4gICAgJG1lbnVTd2l0Y2guYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBjb25zb2xlLmxvZygnbWVudS1jb2xsYXBzZSA6OiBoYW5kbGluZyBldmVudCBvbiAjbmF2LXRvZ2dsZScpO1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgICRjb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnbmF2LWFjdGl2ZScpO1xuICAgIH0sIGZhbHNlKTtcbiAgICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zb2xlLmxvZygnbWVudS1jb2xsYXBzZSA6OiBoYW5kbGluZyBldmVudCBvbiBib2R5Jyk7XG4gICAgICAgICRjb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnbmF2LWFjdGl2ZScpO1xuICAgIH0sIGZhbHNlKTtcbn0sIGZhbHNlKTtcbiIsIi8qKlxuICogQ3JlYXRlZCBieSBhZHJpYW5wIG9uIDAyLjA3LjE1LlxuICovXG5pbnRlcmZhY2UgU2xpZGVyRGF0YSBleHRlbmRzIERPTVN0cmluZ01hcCB7XG4gICAgZGVsYXk6IHN0cmluZztcbn1cbmludGVyZmFjZSBTbGlkZURhdGEgZXh0ZW5kcyBET01TdHJpbmdNYXAge1xuICAgIG51bTogc3RyaW5nO1xufVxuaW50ZXJmYWNlIERvdERhdGEgZXh0ZW5kcyBET01TdHJpbmdNYXAge1xuICAgIG51bTogc3RyaW5nO1xufVxuaW50ZXJmYWNlIEltZ0RhdGEgZXh0ZW5kcyBET01TdHJpbmdNYXAge1xuICAgIHJlYWR5OiBzdHJpbmc7XG59XG5jbGFzcyBTbGlkZXIge1xuICAgIHByaXZhdGUgbmV4dFNsaWRlRGVsYXkgPSA1MDAwO1xuICAgIHByaXZhdGUgbmV4dFNsaWRlVGltZW91dDtcblxuICAgIHByaXZhdGUgdHJhbnNpdGlvbiA9ICdmYWRpbmcnO1xuXG4gICAgcHJpdmF0ZSAkc2xpZGVyOiBIVE1MRWxlbWVudDtcbiAgICBwcml2YXRlICRzbGlkZXNDb250YWluZXI6IEhUTUxFbGVtZW50O1xuICAgIHByaXZhdGUgJCRzbGlkZXM6IE5vZGVMaXN0O1xuICAgIHByaXZhdGUgJGRvdHNDb250YWluZXI6IEhUTUxFbGVtZW50O1xuXG4gICAgcHJpdmF0ZSBhdXRvUHJvZ3Jlc3MgPSB0cnVlO1xuICAgIHByaXZhdGUgYWxsUmVhZHkgPSBmYWxzZTtcblxuICAgIGNvbnN0cnVjdG9yKHNsaWRlclNlbGVjdG9yOiBzdHJpbmcpXG4gICAge1xuICAgICAgICBjb25zb2xlLmxvZygnU2xpZGVyOjpjb25zdHJ1Y3RvcigpJyk7XG4gICAgICAgIHRoaXMuJHNsaWRlciA9IDxIVE1MRWxlbWVudD4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzbGlkZXJTZWxlY3Rvcik7XG4gICAgICAgIGlmICghdGhpcy4kc2xpZGVyKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ1NsaWRlcjo6Y29uc3RydWN0b3IoKSA9PiBubyBzbGlkZXIgZm91bmQgdmlhIFwiJXNcIicsIHNsaWRlclNlbGVjdG9yKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLiRzbGlkZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdzbGlkaW5nJykpIHtcbiAgICAgICAgICAgIHRoaXMudHJhbnNpdGlvbiA9ICdzbGlkaW5nJztcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBzbGlkZXJEYXRhID0gPFNsaWRlckRhdGE+IHRoaXMuJHNsaWRlci5kYXRhc2V0O1xuICAgICAgICBpZiAoc2xpZGVyRGF0YS5kZWxheSkge1xuICAgICAgICAgICAgdGhpcy5uZXh0U2xpZGVEZWxheSA9IHBhcnNlSW50KHNsaWRlckRhdGEuZGVsYXkpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy4kc2xpZGVzQ29udGFpbmVyID0gPEhUTUxFbGVtZW50PiB0aGlzLiRzbGlkZXIucXVlcnlTZWxlY3RvcignLnNsaWRlcycpO1xuICAgICAgICBpZiAoIXRoaXMuJHNsaWRlc0NvbnRhaW5lcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignU2xpZGVyOjpjb25zdHJ1Y3RvcigpID0+IFNsaWRlcyBzaG91bGQgYmUgcGxhY2VkIGluIFwiLnNsaWRlc1wiIGNvbnRhaW5lcicpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuJCRzbGlkZXMgPSB0aGlzLiRzbGlkZXNDb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLnNsaWRlJyk7XG5cbiAgICAgICAgaWYgKHRoaXMuJCRzbGlkZXMubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTbGlkZXI6OmNvbnN0cnVjdG9yKCkgPT4gbm90aGluZyB0byByb3RhdGUnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuJGRvdHNDb250YWluZXIgPSA8SFRNTEVsZW1lbnQ+IHRoaXMuJHNsaWRlci5xdWVyeVNlbGVjdG9yKCcuZG90cycpO1xuXG4gICAgICAgIGlmICh0aGlzLiQkc2xpZGVzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIHRoaXMuJHNsaWRlci5jbGFzc0xpc3QuYWRkKCdjb250cm9sbGFibGUnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuJHNsaWRlci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW92ZXInLCB0aGlzLmhhbmRsZUhvdmVyLCBmYWxzZSk7XG4gICAgICAgIHRoaXMuJHNsaWRlci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW91dCcsIHRoaXMuaGFuZGxlSG92ZXIsIGZhbHNlKTtcblxuICAgICAgICBpZiAodGhpcy4kc2xpZGVyLnF1ZXJ5U2VsZWN0b3IoJy5wcmV2JykpIHtcbiAgICAgICAgICAgIHRoaXMuJHNsaWRlci5xdWVyeVNlbGVjdG9yKCcucHJldicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5hcnJvd0NsaWNrLCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuJHNsaWRlci5xdWVyeVNlbGVjdG9yKCcubmV4dCcpKSB7XG4gICAgICAgICAgICB0aGlzLiRzbGlkZXIucXVlcnlTZWxlY3RvcignLm5leHQnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuYXJyb3dDbGljaywgZmFsc2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMudHJhbnNpdGlvbiA9PSAnc2xpZGluZycpIHtcbiAgICAgICAgICAgIHRoaXMuJHNsaWRlc0NvbnRhaW5lci5zdHlsZS53aWR0aCA9ICh0aGlzLiQkc2xpZGVzLmxlbmd0aCAqIDEwMCkgKyAnJSc7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaTwgdGhpcy4kJHNsaWRlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyICRzbGlkZSA9IDxIVE1MRWxlbWVudD4gdGhpcy4kJHNsaWRlc1tpXTtcbiAgICAgICAgICAgIHZhciBzbGlkZURhdGEgPSA8U2xpZGVEYXRhPiAkc2xpZGUuZGF0YXNldDtcbiAgICAgICAgICAgIHNsaWRlRGF0YS5udW0gPSAoaSsxKS50b1N0cmluZygpO1xuICAgICAgICAgICAgJHNsaWRlLmNsYXNzTGlzdC5hZGQoJ3NsaWRlLScgKyBzbGlkZURhdGEubnVtKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuJGRvdHNDb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICB2YXIgJGN1cnJlbnREb3QgPSA8SFRNTFNwYW5FbGVtZW50PiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnREb3REYXRhID0gPERvdERhdGE+ICRjdXJyZW50RG90LmRhdGFzZXQ7XG4gICAgICAgICAgICAgICAgJGN1cnJlbnREb3QuY2xhc3NOYW1lID0gJ2RvdCc7XG4gICAgICAgICAgICAgICAgY3VycmVudERvdERhdGEubnVtID0gKGkrMSkudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICAkY3VycmVudERvdC5jbGFzc0xpc3QuYWRkKCdzbGlkZS0nICsgY3VycmVudERvdERhdGEubnVtKTtcblxuICAgICAgICAgICAgICAgICRjdXJyZW50RG90LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5kb3RDbGljaywgZmFsc2UpO1xuICAgICAgICAgICAgICAgIHRoaXMuJGRvdHNDb250YWluZXIuYXBwZW5kQ2hpbGQoJGN1cnJlbnREb3QpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgJCRpbWdzID0gJHNsaWRlLnF1ZXJ5U2VsZWN0b3JBbGwoJ2ltZycpO1xuICAgICAgICAgICAgZm9yICh2YXIgaTIgPSAwOyBpMiA8ICQkaW1ncy5sZW5ndGg7IGkyKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgJGltZyA9IDxIVE1MSW1hZ2VFbGVtZW50PiAkJGltZ3NbaTJdO1xuICAgICAgICAgICAgICAgIHZhciBpbWdEYXRhID0gPEltZ0RhdGE+ICRpbWcuZGF0YXNldDtcbiAgICAgICAgICAgICAgICBpbWdEYXRhLnJlYWR5ID0gJGltZy5jb21wbGV0ZSA/ICd0cnVlJyA6ICdmYWxzZSc7XG4gICAgICAgICAgICAgICAgJGltZy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgdGhpcy5pbWdSZWFkeU5vdGlmaWNhdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgJGltZ1NyYyA9IDxIVE1MSW1hZ2VFbGVtZW50PiAkc2xpZGUucXVlcnlTZWxlY3RvcignLnNyYycpO1xuICAgICAgICAgICAgaWYgKCRpbWdTcmMpIHtcbiAgICAgICAgICAgICAgICAkc2xpZGUuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gJ3VybCgnICsgJGltZ1NyYy5zcmMgKyAnKSc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmhlaWdodEd1YXJkKCk7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLmhlaWdodEd1YXJkLCBmYWxzZSk7XG5cbiAgICAgICAgdGhpcy5pbWdSZWFkeVdhaXQoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGhlaWdodEd1YXJkID0gKCkgPT4ge1xuICAgICAgICB0aGlzLiRzbGlkZXNDb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gbnVsbDtcbiAgICAgICAgdGhpcy4kc2xpZGVzQ29udGFpbmVyLnN0eWxlLmhlaWdodCA9IHRoaXMuJHNsaWRlc0NvbnRhaW5lci5jbGllbnRIZWlnaHQgKyAncHgnO1xuICAgIH07XG5cbiAgICBwdWJsaWMgaGFuZGxlSG92ZXIgPSAoZTogRXZlbnQpID0+IHtcbiAgICAgICAgY29uc29sZS5kZWJ1ZygnU2xpZGVyOjpoYW5kbGVIb3ZlcigpJyk7XG4gICAgICAgIGlmIChlLnR5cGUgPT09ICdtb3VzZW92ZXInKSB7XG4gICAgICAgICAgICB0aGlzLmF1dG9Qcm9ncmVzcyA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5ibG9ja0F1dG9Qcm9ncmVzcygpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlLnR5cGUgPT09ICdtb3VzZW91dCcpIHtcbiAgICAgICAgICAgIHRoaXMuYXV0b1Byb2dyZXNzID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMucmVzdW1lQXV0b1Byb2dyZXNzKCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcHVibGljIGJsb2NrQXV0b1Byb2dyZXNzID0gKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmRlYnVnKCdTbGlkZXI6OmJsb2NrQXV0b1Byb2dyZXNzKCknKTtcbiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMubmV4dFNsaWRlVGltZW91dCk7XG4gICAgICAgIHRoaXMubmV4dFNsaWRlVGltZW91dCA9IDA7XG4gICAgfTtcblxuICAgIHB1YmxpYyByZXN1bWVBdXRvUHJvZ3Jlc3MgPSAoKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZGVidWcoJ1NsaWRlcjo6cmVzdW1lQXV0b1Byb2dyZXNzKCknKTtcbiAgICAgICAgaWYgKHRoaXMuYWxsUmVhZHkgJiYgdGhpcy5hdXRvUHJvZ3Jlc3MgJiYgdGhpcy5uZXh0U2xpZGVEZWxheSA+IDApIHtcbiAgICAgICAgICAgIHRoaXMubmV4dFNsaWRlVGltZW91dCA9IHNldFRpbWVvdXQodGhpcy5sb2FkU2xpZGUsIHRoaXMubmV4dFNsaWRlRGVsYXkpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHB1YmxpYyBsb2FkU2xpZGUgPSAobnVtPzogbnVtYmVyKSA9PiB7XG4gICAgICAgIHRoaXMuYmxvY2tBdXRvUHJvZ3Jlc3MoKTtcbiAgICAgICAgaWYgKCF0aGlzLmFsbFJlYWR5KSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdmFyICRjdXJyZW50LCBjdXJyZW50RGF0YSwgJG5leHQsIG5leHREYXRhLCBjdXJyZW50TnVtLCBuZXh0TnVtLCAkY3VycmVudERvdCwgJG5leHREb3Q7XG4gICAgICAgICRjdXJyZW50ID0gPEhUTUxFbGVtZW50PiB0aGlzLiRzbGlkZXIucXVlcnlTZWxlY3RvcignLnNsaWRlLmFjdGl2ZScpO1xuXG4gICAgICAgIGlmICghbnVtKSB7XG4gICAgICAgICAgICBpZiAoISRjdXJyZW50KSB7XG4gICAgICAgICAgICAgICAgJG5leHQgPSA8SFRNTEVsZW1lbnQ+IHRoaXMuJHNsaWRlci5xdWVyeVNlbGVjdG9yKCcuc2xpZGUuaW5pdGlhbCcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkbmV4dCA9IDxIVE1MRWxlbWVudD4gdGhpcy4kc2xpZGVyLnF1ZXJ5U2VsZWN0b3IoJy5zbGlkZS5hY3RpdmUgKyAuc2xpZGUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghJG5leHQpIHtcbiAgICAgICAgICAgICAgICAkbmV4dCA9IDxIVE1MRWxlbWVudD4gdGhpcy4kc2xpZGVyLnF1ZXJ5U2VsZWN0b3IoJy5zbGlkZTpudGgtY2hpbGQoMSknKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICRuZXh0ID0gPEhUTUxFbGVtZW50PiB0aGlzLiRzbGlkZXIucXVlcnlTZWxlY3RvcignLnNsaWRlOm50aC1jaGlsZCgnICsgbnVtICsgJyknKTtcbiAgICAgICAgfVxuICAgICAgICBuZXh0RGF0YSA9IDxTbGlkZURhdGE+ICRuZXh0LmRhdGFzZXQ7XG4gICAgICAgIGlmICgkY3VycmVudCkge1xuICAgICAgICAgICAgJGN1cnJlbnQuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG4gICAgICAgICAgICBjdXJyZW50RGF0YSA9IDxTbGlkZURhdGE+ICRjdXJyZW50LmRhdGFzZXQ7XG4gICAgICAgICAgICBjdXJyZW50TnVtID0gY3VycmVudERhdGEubnVtIHx8ICRjdXJyZW50LmNsYXNzTmFtZS5tYXRjaCgvc2xpZGUtKFxcZCspLylbMV07XG4gICAgICAgICAgICBpZiAodGhpcy4kZG90c0NvbnRhaW5lcikge1xuICAgICAgICAgICAgICAgICRjdXJyZW50RG90ID0gPEhUTUxFbGVtZW50PiB0aGlzLiRkb3RzQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5kb3Q6bnRoLWNoaWxkKCcgKyBjdXJyZW50TnVtICsgJyknKTtcbiAgICAgICAgICAgICAgICAkY3VycmVudERvdC5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAkbmV4dC5jbGFzc0xpc3QucmVtb3ZlKCdpbml0aWFsJyk7XG4gICAgICAgICRuZXh0LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuICAgICAgICBuZXh0TnVtID0gbmV4dERhdGEubnVtIHx8ICRuZXh0LmNsYXNzTmFtZS5tYXRjaCgvc2xpZGUtKFxcZCspLylbMV07XG4gICAgICAgIHRoaXMuJHNsaWRlci5jbGFzc05hbWUgPSB0aGlzLiRzbGlkZXIuY2xhc3NOYW1lLnJlcGxhY2UoL3NsaWRlLShcXGQrKS1hY3RpdmUvLCAnJyk7XG4gICAgICAgIHRoaXMuJHNsaWRlci5jbGFzc0xpc3QuYWRkKCdzbGlkZS0nICsgbmV4dE51bSArICctYWN0aXZlJyk7XG4gICAgICAgIGlmICh0aGlzLiRkb3RzQ29udGFpbmVyKSB7XG4gICAgICAgICAgICAkbmV4dERvdCA9IDxIVE1MRWxlbWVudD4gdGhpcy4kZG90c0NvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZG90Om50aC1jaGlsZCgnICsgbmV4dE51bSArICcpJyk7XG4gICAgICAgICAgICAkbmV4dERvdC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJlc3VtZUF1dG9Qcm9ncmVzcygpO1xuICAgIH07XG5cbiAgICBwdWJsaWMgYXJyb3dDbGljayA9IChlKSA9PiB7XG4gICAgICAgIHZhciAkbmV4dCwgbmV4dERhdGEsIG51bSwgJGFycm93ID0gPEhUTUxFbGVtZW50PiBlLnRhcmdldDtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgICAgICBpZiAoJGFycm93LmNsYXNzTGlzdC5jb250YWlucygncHJldicpKSB7XG4gICAgICAgICAgICAkbmV4dCA9IDxIVE1MRWxlbWVudD4gdGhpcy4kc2xpZGVyLnF1ZXJ5U2VsZWN0b3IoJy5zbGlkZSArIC5zbGlkZS5hY3RpdmUnKTtcbiAgICAgICAgICAgIGlmICgkbmV4dCkge1xuICAgICAgICAgICAgICAgICRuZXh0ID0gJG5leHQucHJldmlvdXNFbGVtZW50U2libGluZztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJG5leHQgPSA8SFRNTEVsZW1lbnQ+IHRoaXMuJHNsaWRlci5xdWVyeVNlbGVjdG9yKCcuc2xpZGU6bGFzdC1vZi10eXBlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCRhcnJvdy5jbGFzc0xpc3QuY29udGFpbnMoJ25leHQnKSkge1xuICAgICAgICAgICAgJG5leHQgPSA8SFRNTEVsZW1lbnQ+ICh0aGlzLiRzbGlkZXIucXVlcnlTZWxlY3RvcignLnNsaWRlLmFjdGl2ZSArIC5zbGlkZScpIHx8IHRoaXMuJHNsaWRlci5xdWVyeVNlbGVjdG9yKCcuc2xpZGU6bnRoLWNoaWxkKDEpJykpO1xuICAgICAgICB9XG4gICAgICAgIG5leHREYXRhID0gPFNsaWRlRGF0YT4gJG5leHQuZGF0YXNldDtcbiAgICAgICAgbnVtID0gbmV4dERhdGEubnVtIHx8ICRuZXh0LmNsYXNzTmFtZS5tYXRjaCgvc2xpZGUtKFxcZCspLylbMV07XG4gICAgICAgIHRoaXMubG9hZFNsaWRlKG51bSk7XG4gICAgfTtcblxuICAgIHB1YmxpYyBkb3RDbGljayA9IChlKSA9PiB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgdmFyICRkb3QgPSA8SFRNTEVsZW1lbnQ+IGUudGFyZ2V0O1xuICAgICAgICB2YXIgZG90RGF0YSA9IDxEb3REYXRhPiAkZG90LmRhdGFzZXQ7XG4gICAgICAgIHZhciBudW0gPSBwYXJzZUludChkb3REYXRhLm51bSB8fCBlLnRhcmdldC5jbGFzc05hbWUubWF0Y2goL3NsaWRlLShcXGQrKS8pWzFdKTtcbiAgICAgICAgdGhpcy5sb2FkU2xpZGUobnVtKTtcbiAgICB9O1xuXG4gICAgcHVibGljIGltZ1JlYWR5Tm90aWZpY2F0aW9uID0gKGUpID0+IHtcbiAgICAgICAgdmFyICRpbWcgPSA8SFRNTEltYWdlRWxlbWVudD4gZS50YXJnZXQ7XG4gICAgICAgIHZhciBpbWdEYXRhID0gPEltZ0RhdGE+ICRpbWcuZGF0YXNldDtcbiAgICAgICAgaW1nRGF0YS5yZWFkeSA9ICd0cnVlJztcbiAgICAgICAgdGhpcy5oZWlnaHRHdWFyZCgpO1xuICAgIH07XG5cbiAgICBwdWJsaWMgaW1nUmVhZHlXYWl0ID0gKCkgPT4ge1xuICAgICAgICB2YXIgJCRpbWcgPSB0aGlzLiRzbGlkZXIucXVlcnlTZWxlY3RvckFsbCgnLnNsaWRlIGltZ1tkYXRhLXJlYWR5PVwiZmFsc2VcIl0nKTtcbiAgICAgICAgaWYgKCQkaW1nLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHNldFRpbWVvdXQodGhpcy5pbWdSZWFkeVdhaXQsIDEwMCk7XG4gICAgICAgICAgICB0aGlzLiRzbGlkZXIuY2xhc3NMaXN0LmFkZCgnd2FpdGluZycpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYWxsUmVhZHkgPSB0cnVlO1xuICAgICAgICB0aGlzLiRzbGlkZXIuY2xhc3NMaXN0LnJlbW92ZSgnd2FpdGluZycpO1xuICAgICAgICB0aGlzLiRzbGlkZXIuY2xhc3NMaXN0LmFkZCgncmVhZHknKTtcbiAgICAgICAgdGhpcy5sb2FkU2xpZGUoKTtcbiAgICB9O1xufVxuXG4iXX0=