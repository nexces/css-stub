document.addEventListener('DOMContentLoaded', function () {
    var $container = document.querySelector('.siteHeader');
    var $menuSwitch = document.querySelector('#nav-toggle');
    console.log('menu-collapse :: init');
    $menuSwitch.addEventListener('click', function (e) {
        console.log('menu-collapse :: handling event on #nav-toggle');
        e.preventDefault();
        e.stopPropagation();
        e.stopImmediatePropagation();
        $container.classList.toggle('nav-active');
    }, false);
    document.body.addEventListener('click', function () {
        console.log('menu-collapse :: handling event on body');
        $container.classList.remove('nav-active');
    }, false);
}, false);
var Slider = (function () {
    function Slider(sliderSelector, sliderConfiguration) {
        var _this = this;
        this.nextSlideDelay = 5000;
        this.setBackground = true;
        this.transition = 'fade';
        this.autoProgress = true;
        this.allReady = false;
        this.containerHeight = 0;
        this.heightGuard = function () {
            var $slide, i;
            for (i = 0; i < _this.$$slides.length; i++) {
                $slide = _this.$$slides[i];
                $slide.style.minHeight = null;
            }
            _this.containerHeight = _this.$slidesContainer.clientHeight;
            for (i = 0; i < _this.$$slides.length; i++) {
                $slide = _this.$$slides[i];
                $slide.style.minHeight = _this.containerHeight + 'px';
            }
        };
        this.handleHover = function (e) {
            console.debug('Slider::handleHover()');
            if (e.type === 'mouseover') {
                _this.autoProgress = false;
                _this.blockAutoProgress();
            }
            if (e.type === 'mouseout') {
                _this.autoProgress = true;
                _this.resumeAutoProgress();
            }
        };
        this.blockAutoProgress = function () {
            console.debug('Slider::blockAutoProgress()');
            clearTimeout(_this.nextSlideTimeout);
            _this.nextSlideTimeout = 0;
        };
        this.resumeAutoProgress = function () {
            console.debug('Slider::resumeAutoProgress()');
            if (_this.allReady && _this.autoProgress) {
                _this.nextSlideTimeout = setTimeout(_this.loadSlide, _this.nextSlideDelay);
            }
        };
        this.loadSlide = function (num) {
            _this.blockAutoProgress();
            if (!_this.allReady) {
                return false;
            }
            var $current, currentData, $next, nextData, currentNum, nextNum, $currentDot, $nextDot;
            $current = _this.$slider.querySelector('.slide.active');
            if (!num) {
                if (!$current) {
                    $next = _this.$slider.querySelector('.slide.initial');
                }
                else {
                    $next = _this.$slider.querySelector('.slide.active + .slide');
                }
                if (!$next) {
                    $next = _this.$slider.querySelector('.slide:nth-child(1)');
                }
            }
            else {
                $next = _this.$slider.querySelector('.slide:nth-child(' + num + ')');
            }
            nextData = $next.dataset;
            if ($current) {
                $current.classList.remove('active');
                currentData = $current.dataset;
                currentNum = currentData.num || $current.className.match(/slide-(\d+)/)[1];
                if (_this.$dotsContainer) {
                    $currentDot = _this.$dotsContainer.querySelector('.dot:nth-child(' + currentNum + ')');
                    $currentDot.classList.remove('active');
                }
            }
            $next.classList.remove('initial');
            $next.classList.add('active');
            nextNum = nextData.num || $next.className.match(/slide-(\d+)/)[1];
            _this.$slider.className = _this.$slider.className.replace(/slide-(\d+)-active/, '');
            _this.$slider.classList.add('slide-' + nextNum + '-active');
            if (_this.$dotsContainer) {
                $nextDot = _this.$dotsContainer.querySelector('.dot:nth-child(' + nextNum + ')');
                $nextDot.classList.add('active');
            }
            _this.resumeAutoProgress();
        };
        this.arrowClick = function (e) {
            var $next, nextData, num, $arrow = e.target;
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();
            if ($arrow.classList.contains('prev')) {
                $next = _this.$slider.querySelector('.slide + .slide.active');
                if ($next) {
                    $next = $next.previousElementSibling;
                }
                else {
                    $next = _this.$slider.querySelector('.slide:last-of-type');
                }
            }
            if ($arrow.classList.contains('next')) {
                $next = (_this.$slider.querySelector('.slide.active + .slide') || _this.$slider.querySelector('.slide:nth-child(1)'));
            }
            nextData = $next.dataset;
            num = nextData.num || $next.className.match(/slide-(\d+)/)[1];
            _this.loadSlide(num);
        };
        this.dotClick = function (e) {
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();
            var $dot = e.target;
            var dotData = $dot.dataset;
            var num = parseInt(dotData.num || e.target.className.match(/slide-(\d+)/)[1]);
            _this.loadSlide(num);
        };
        this.imgReadyNotification = function (e) {
            var $img = e.target;
            var imgData = $img.dataset;
            imgData.ready = 'true';
        };
        this.imgReadyWait = function () {
            var $$img = _this.$slider.querySelectorAll('.slide .src[data-ready="false"]');
            if ($$img.length > 0) {
                setTimeout(_this.imgReadyWait, 100);
                _this.$slider.classList.add('waiting');
                return false;
            }
            _this.allReady = true;
            _this.$slider.classList.remove('waiting');
            _this.$slider.classList.add('ready');
            _this.loadSlide();
        };
        console.log('Slider::constructor()');
        this.$slider = document.querySelector(sliderSelector);
        if (!this.$slider) {
            console.warn('Slider::constructor() => no slider found via "%s"', sliderSelector);
            return this;
        }
        if (sliderConfiguration) {
            if (sliderConfiguration.nextSlideDelay) {
                this.nextSlideDelay = sliderConfiguration.nextSlideDelay;
            }
            if (sliderConfiguration.setBackground) {
                this.setBackground = sliderConfiguration.setBackground;
            }
        }
        if (this.$slider.classList.contains('slide')) {
            this.transition = 'slide';
        }
        this.$slidesContainer = this.$slider.querySelector('.slides');
        this.$$slides = this.$slidesContainer.querySelectorAll('.slide');
        if (this.$$slides.length == 0) {
            console.log('Slider::constructor() => nothing to rotate');
            return;
        }
        this.$dotsContainer = this.$slider.querySelector('.dots');
        if (this.$$slides.length > 1) {
            this.$slider.classList.add('controllable');
            if (this.transition == 'slide') {
                var $slides = this.$slider.querySelector('.slides');
                $slides.style.width = (this.$$slides.length * 100) + '%';
            }
        }
        this.$slider.addEventListener('mouseover', this.handleHover, false);
        this.$slider.addEventListener('mouseout', this.handleHover, false);
        if (this.$slider.querySelector('.prev')) {
            this.$slider.querySelector('.prev').addEventListener('click', this.arrowClick, false);
        }
        if (this.$slider.querySelector('.next')) {
            this.$slider.querySelector('.next').addEventListener('click', this.arrowClick, false);
        }
        if (this.transition == 'slide') {
            this.$slidesContainer.style.width = (this.$$slides.length * 100) + '%';
        }
        for (var i = 0; i < this.$$slides.length; i++) {
            var $slide = this.$$slides[i];
            var slideData = $slide.dataset;
            slideData.num = (i + 1).toString();
            $slide.classList.add('slide-' + (i + 1));
            var $currentDot = document.createElement('span');
            var currentDotData = $currentDot.dataset;
            $currentDot.className = 'dot';
            currentDotData.num = (i + 1).toString();
            $currentDot.classList.add('slide-' + (i + 1));
            $currentDot.addEventListener('click', this.dotClick, false);
            if (this.$dotsContainer) {
                this.$dotsContainer.appendChild($currentDot);
            }
            if (this.setBackground) {
                var $img = $slide.querySelector('.src');
                var imgData = $img.dataset;
                $slide.style.backgroundImage = 'url(' + $img.src + ')';
                imgData.ready = $img.complete ? 'true' : 'false';
                $img.addEventListener('load', this.imgReadyNotification);
            }
        }
        this.heightGuard();
        window.addEventListener('resize', this.heightGuard, false);
        if (this.setBackground) {
            this.imgReadyWait();
        }
        else {
            this.allReady = true;
            this.$slider.classList.remove('waiting');
            this.$slider.classList.add('ready');
            this.loadSlide();
        }
    }
    return Slider;
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NvdXJjZXMvdHMvbWVudS1jb2xsYXBzZS50cyIsIi4uLy4uL3NvdXJjZXMvdHMvc2xpZGVyLnRzIl0sIm5hbWVzIjpbIlNsaWRlciIsIlNsaWRlci5jb25zdHJ1Y3RvciJdLCJtYXBwaW5ncyI6IkFBR0EsUUFBUSxDQUFDLGdCQUFnQixDQUFDLGtCQUFrQixFQUFFO0lBQzFDLElBQUksVUFBVSxHQUFpQixRQUFRLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQ3JFLElBQUksV0FBVyxHQUFpQixRQUFRLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQ3RFLE9BQU8sQ0FBQyxHQUFHLENBQUMsdUJBQXVCLENBQUMsQ0FBQztJQUNyQyxXQUFXLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLFVBQVUsQ0FBQztRQUM3QyxPQUFPLENBQUMsR0FBRyxDQUFDLGdEQUFnRCxDQUFDLENBQUM7UUFDOUQsQ0FBQyxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ25CLENBQUMsQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUNwQixDQUFDLENBQUMsd0JBQXdCLEVBQUUsQ0FBQztRQUM3QixVQUFVLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUM5QyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDVixRQUFRLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRTtRQUNwQyxPQUFPLENBQUMsR0FBRyxDQUFDLHlDQUF5QyxDQUFDLENBQUM7UUFDdkQsVUFBVSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDOUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQ2QsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO0FDRFY7SUFrQklBLGdCQUFZQSxjQUFzQkEsRUFBRUEsbUJBQXlDQTtRQWxCakZDLGlCQThQQ0E7UUE3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Q0E7UUFFREEsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxHQUFpQkEsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsYUFBYUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0E7UUFDNUVBLElBQUlBLENBQUNBLFFBQVFBLEdBQUdBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxRQUFRQSxDQUFDQSxDQUFDQTtRQUVqRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsTUFBTUEsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDNUJBLE9BQU9BLENBQUNBLEdBQUdBLENBQUNBLDRDQUE0Q0EsQ0FBQ0EsQ0FBQ0E7WUFDMURBLE1BQU1BLENBQUNBO1FBQ1hBLENBQUNBO1FBRURBLElBQUlBLENBQUNBLGNBQWNBLEdBQWlCQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxhQUFhQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQTtRQUV4RUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsTUFBTUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDM0JBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLFNBQVNBLENBQUNBLEdBQUdBLENBQUNBLGNBQWNBLENBQUNBLENBQUNBO1lBQzNDQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxJQUFJQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDN0JBLElBQUlBLE9BQU9BLEdBQWlCQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxhQUFhQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQTtnQkFDbEVBLE9BQU9BLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLE1BQU1BLEdBQUdBLEdBQUdBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBO1lBQzdEQSxDQUFDQTtRQUNMQSxDQUFDQTtRQUVEQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxnQkFBZ0JBLENBQUNBLFdBQVdBLEVBQUVBLElBQUlBLENBQUNBLFdBQVdBLEVBQUVBLEtBQUtBLENBQUNBLENBQUNBO1FBQ3BFQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxnQkFBZ0JBLENBQUNBLFVBQVVBLEVBQUVBLElBQUlBLENBQUNBLFdBQVdBLEVBQUVBLEtBQUtBLENBQUNBLENBQUNBO1FBRW5FQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxhQUFhQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN0Q0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsYUFBYUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxPQUFPQSxFQUFFQSxJQUFJQSxDQUFDQSxVQUFVQSxFQUFFQSxLQUFLQSxDQUFDQSxDQUFDQTtRQUMxRkEsQ0FBQ0E7UUFDREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsYUFBYUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDdENBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLGFBQWFBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsT0FBT0EsRUFBRUEsSUFBSUEsQ0FBQ0EsVUFBVUEsRUFBRUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7UUFDMUZBLENBQUNBO1FBRURBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLElBQUlBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBO1lBQzdCQSxJQUFJQSxDQUFDQSxnQkFBZ0JBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLE1BQU1BLEdBQUdBLEdBQUdBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBO1FBQzNFQSxDQUFDQTtRQUVEQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFFQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtZQUMzQ0EsSUFBSUEsTUFBTUEsR0FBaUJBLElBQUlBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQzVDQSxJQUFJQSxTQUFTQSxHQUFlQSxNQUFNQSxDQUFDQSxPQUFPQSxDQUFDQTtZQUMzQ0EsU0FBU0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsUUFBUUEsRUFBRUEsQ0FBQ0E7WUFDakNBLE1BQU1BLENBQUNBLFNBQVNBLENBQUNBLEdBQUdBLENBQUNBLFFBQVFBLEdBQUdBLENBQUNBLENBQUNBLEdBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBRXZDQSxJQUFJQSxXQUFXQSxHQUFxQkEsUUFBUUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7WUFDbkVBLElBQUlBLGNBQWNBLEdBQWFBLFdBQVdBLENBQUNBLE9BQU9BLENBQUNBO1lBQ25EQSxXQUFXQSxDQUFDQSxTQUFTQSxHQUFHQSxLQUFLQSxDQUFDQTtZQUM5QkEsY0FBY0EsQ0FBQ0EsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsUUFBUUEsRUFBRUEsQ0FBQ0E7WUFDdENBLFdBQVdBLENBQUNBLFNBQVNBLENBQUNBLEdBQUdBLENBQUNBLFFBQVFBLEdBQUdBLENBQUNBLENBQUNBLEdBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBRTVDQSxXQUFXQSxDQUFDQSxnQkFBZ0JBLENBQUNBLE9BQU9BLEVBQUVBLElBQUlBLENBQUNBLFFBQVFBLEVBQUVBLEtBQUtBLENBQUNBLENBQUNBO1lBQzVEQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDdEJBLElBQUlBLENBQUNBLGNBQWNBLENBQUNBLFdBQVdBLENBQUNBLFdBQVdBLENBQUNBLENBQUNBO1lBQ2pEQSxDQUFDQTtZQUNEQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDckJBLElBQUlBLElBQUlBLEdBQXNCQSxNQUFNQSxDQUFDQSxhQUFhQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtnQkFDM0RBLElBQUlBLE9BQU9BLEdBQWFBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBO2dCQUNyQ0EsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsZUFBZUEsR0FBR0EsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0E7Z0JBQ3ZEQSxPQUFPQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxRQUFRQSxHQUFHQSxNQUFNQSxHQUFHQSxPQUFPQSxDQUFDQTtnQkFDakRBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsTUFBTUEsRUFBRUEsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxDQUFDQTtZQUM3REEsQ0FBQ0E7UUFDTEEsQ0FBQ0E7UUFFREEsSUFBSUEsQ0FBQ0EsV0FBV0EsRUFBRUEsQ0FBQ0E7UUFDbkJBLE1BQU1BLENBQUNBLGdCQUFnQkEsQ0FBQ0EsUUFBUUEsRUFBRUEsSUFBSUEsQ0FBQ0EsV0FBV0EsRUFBRUEsS0FBS0EsQ0FBQ0EsQ0FBQ0E7UUFFM0RBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLENBQUNBLENBQUNBO1lBQ3JCQSxJQUFJQSxDQUFDQSxZQUFZQSxFQUFFQSxDQUFDQTtRQUN4QkEsQ0FBQ0E7UUFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDSkEsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0E7WUFDckJBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLFNBQVNBLENBQUNBLE1BQU1BLENBQUNBLFNBQVNBLENBQUNBLENBQUNBO1lBQ3pDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxTQUFTQSxDQUFDQSxHQUFHQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQTtZQUNwQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsRUFBRUEsQ0FBQ0E7UUFDckJBLENBQUNBO0lBQ0xBLENBQUNBO0lBdUlMRCxhQUFDQTtBQUFEQSxDQUFDQSxBQTlQRCxJQThQQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ3JlYXRlZCBieSBhZHJpYW5wIG9uIDMwLjA2LjE1LlxuICovXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgZnVuY3Rpb24gKCkge1xuICAgIHZhciAkY29udGFpbmVyID0gPEhUTUxFbGVtZW50PiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2l0ZUhlYWRlcicpO1xuICAgIHZhciAkbWVudVN3aXRjaCA9IDxIVE1MRWxlbWVudD4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI25hdi10b2dnbGUnKTtcbiAgICBjb25zb2xlLmxvZygnbWVudS1jb2xsYXBzZSA6OiBpbml0Jyk7XG4gICAgJG1lbnVTd2l0Y2guYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBjb25zb2xlLmxvZygnbWVudS1jb2xsYXBzZSA6OiBoYW5kbGluZyBldmVudCBvbiAjbmF2LXRvZ2dsZScpO1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgICRjb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnbmF2LWFjdGl2ZScpO1xuICAgIH0sIGZhbHNlKTtcbiAgICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zb2xlLmxvZygnbWVudS1jb2xsYXBzZSA6OiBoYW5kbGluZyBldmVudCBvbiBib2R5Jyk7XG4gICAgICAgICRjb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnbmF2LWFjdGl2ZScpO1xuICAgIH0sIGZhbHNlKTtcbn0sIGZhbHNlKTtcbiIsIi8qKlxuICogQ3JlYXRlZCBieSBhZHJpYW5wIG9uIDAyLjA3LjE1LlxuICovXG5pbnRlcmZhY2UgU2xpZGVyQ29uZmlndXJhdGlvbiB7XG4gICAgbmV4dFNsaWRlRGVsYXk/OiBudW1iZXI7XG4gICAgc2V0QmFja2dyb3VuZD86IGJvb2xlYW47XG4gICAgLy90cmFuc2l0aW9uPzogc3RyaW5nO1xufVxuaW50ZXJmYWNlIFNsaWRlRGF0YSBleHRlbmRzIERPTVN0cmluZ01hcCB7XG4gICAgbnVtOiBzdHJpbmc7XG59XG5pbnRlcmZhY2UgRG90RGF0YSBleHRlbmRzIERPTVN0cmluZ01hcCB7XG4gICAgbnVtOiBzdHJpbmc7XG59XG5pbnRlcmZhY2UgSW1nRGF0YSBleHRlbmRzIERPTVN0cmluZ01hcCB7XG4gICAgcmVhZHk6IHN0cmluZztcbn1cbmNsYXNzIFNsaWRlciB7XG4gICAgcHJpdmF0ZSBuZXh0U2xpZGVEZWxheSA9IDUwMDA7XG4gICAgcHJpdmF0ZSBuZXh0U2xpZGVUaW1lb3V0O1xuXG4gICAgcHJpdmF0ZSBzZXRCYWNrZ3JvdW5kID0gdHJ1ZTtcbiAgICBwcml2YXRlIHRyYW5zaXRpb24gPSAnZmFkZSc7XG4gICAgLy9wcml2YXRlIHN1cHBvcnRlZFRyYW5zaXRpb25zID0gWydmYWRlJywgJ3NsaWRlJ107XG5cbiAgICBwcml2YXRlICRzbGlkZXI6IEhUTUxFbGVtZW50O1xuICAgIHByaXZhdGUgJHNsaWRlc0NvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gICAgcHJpdmF0ZSAkJHNsaWRlczogTm9kZUxpc3Q7XG4gICAgcHJpdmF0ZSAkZG90c0NvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG5cbiAgICBwcml2YXRlIGF1dG9Qcm9ncmVzcyA9IHRydWU7XG4gICAgcHJpdmF0ZSBhbGxSZWFkeSA9IGZhbHNlO1xuXG4gICAgcHJpdmF0ZSBjb250YWluZXJIZWlnaHQgPSAwO1xuXG4gICAgY29uc3RydWN0b3Ioc2xpZGVyU2VsZWN0b3I6IHN0cmluZywgc2xpZGVyQ29uZmlndXJhdGlvbj86IFNsaWRlckNvbmZpZ3VyYXRpb24pXG4gICAge1xuICAgICAgICBjb25zb2xlLmxvZygnU2xpZGVyOjpjb25zdHJ1Y3RvcigpJyk7XG4gICAgICAgIHRoaXMuJHNsaWRlciA9IDxIVE1MRWxlbWVudD4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzbGlkZXJTZWxlY3Rvcik7XG4gICAgICAgIGlmICghdGhpcy4kc2xpZGVyKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ1NsaWRlcjo6Y29uc3RydWN0b3IoKSA9PiBubyBzbGlkZXIgZm91bmQgdmlhIFwiJXNcIicsIHNsaWRlclNlbGVjdG9yKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHNsaWRlckNvbmZpZ3VyYXRpb24pIHtcbiAgICAgICAgICAgIGlmIChzbGlkZXJDb25maWd1cmF0aW9uLm5leHRTbGlkZURlbGF5KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5uZXh0U2xpZGVEZWxheSA9IHNsaWRlckNvbmZpZ3VyYXRpb24ubmV4dFNsaWRlRGVsYXk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc2xpZGVyQ29uZmlndXJhdGlvbi5zZXRCYWNrZ3JvdW5kKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRCYWNrZ3JvdW5kID0gc2xpZGVyQ29uZmlndXJhdGlvbi5zZXRCYWNrZ3JvdW5kO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy9pZiAoc2xpZGVyQ29uZmlndXJhdGlvbi50cmFuc2l0aW9uKSB7XG4gICAgICAgICAgICAvLyAgICBpZiAodGhpcy5zdXBwb3J0ZWRUcmFuc2l0aW9ucy5pbmRleE9mKHNsaWRlckNvbmZpZ3VyYXRpb24udHJhbnNpdGlvbikgPiAtMSkge1xuICAgICAgICAgICAgLy8gICAgICAgIHRoaXMudHJhbnNpdGlvbiA9IHNsaWRlckNvbmZpZ3VyYXRpb24udHJhbnNpdGlvbjtcbiAgICAgICAgICAgIC8vICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyAgICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgICAgLy8gICAgICAgICAgICAnU2xpZGVyOjpjb25zdHJ1Y3RvcigpID0+IFVuc3VwcG9ydGVkIHRyYW5zaXRpb24gdHlwZSBcIiVzXCI7IEZhbGxpbmcgYmFjayB0byBcIiVzXCInLFxuICAgICAgICAgICAgLy8gICAgICAgICAgICBzbGlkZXJDb25maWd1cmF0aW9uLnRyYW5zaXRpb24sXG4gICAgICAgICAgICAvLyAgICAgICAgICAgIHRoaXMudHJhbnNpdGlvblxuICAgICAgICAgICAgLy8gICAgICAgICk7XG4gICAgICAgICAgICAvLyAgICB9XG4gICAgICAgICAgICAvL31cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLiRzbGlkZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdzbGlkZScpKSB7XG4gICAgICAgICAgICB0aGlzLnRyYW5zaXRpb24gPSAnc2xpZGUnO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy4kc2xpZGVzQ29udGFpbmVyID0gPEhUTUxFbGVtZW50PiB0aGlzLiRzbGlkZXIucXVlcnlTZWxlY3RvcignLnNsaWRlcycpO1xuICAgICAgICB0aGlzLiQkc2xpZGVzID0gdGhpcy4kc2xpZGVzQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJy5zbGlkZScpO1xuXG4gICAgICAgIGlmICh0aGlzLiQkc2xpZGVzLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnU2xpZGVyOjpjb25zdHJ1Y3RvcigpID0+IG5vdGhpbmcgdG8gcm90YXRlJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLiRkb3RzQ29udGFpbmVyID0gPEhUTUxFbGVtZW50PiB0aGlzLiRzbGlkZXIucXVlcnlTZWxlY3RvcignLmRvdHMnKTtcblxuICAgICAgICBpZiAodGhpcy4kJHNsaWRlcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICB0aGlzLiRzbGlkZXIuY2xhc3NMaXN0LmFkZCgnY29udHJvbGxhYmxlJyk7XG4gICAgICAgICAgICBpZiAodGhpcy50cmFuc2l0aW9uID09ICdzbGlkZScpIHtcbiAgICAgICAgICAgICAgICB2YXIgJHNsaWRlcyA9IDxIVE1MRWxlbWVudD4gdGhpcy4kc2xpZGVyLnF1ZXJ5U2VsZWN0b3IoJy5zbGlkZXMnKTtcbiAgICAgICAgICAgICAgICAkc2xpZGVzLnN0eWxlLndpZHRoID0gKHRoaXMuJCRzbGlkZXMubGVuZ3RoICogMTAwKSArICclJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuJHNsaWRlci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW92ZXInLCB0aGlzLmhhbmRsZUhvdmVyLCBmYWxzZSk7XG4gICAgICAgIHRoaXMuJHNsaWRlci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW91dCcsIHRoaXMuaGFuZGxlSG92ZXIsIGZhbHNlKTtcblxuICAgICAgICBpZiAodGhpcy4kc2xpZGVyLnF1ZXJ5U2VsZWN0b3IoJy5wcmV2JykpIHtcbiAgICAgICAgICAgIHRoaXMuJHNsaWRlci5xdWVyeVNlbGVjdG9yKCcucHJldicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5hcnJvd0NsaWNrLCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuJHNsaWRlci5xdWVyeVNlbGVjdG9yKCcubmV4dCcpKSB7XG4gICAgICAgICAgICB0aGlzLiRzbGlkZXIucXVlcnlTZWxlY3RvcignLm5leHQnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuYXJyb3dDbGljaywgZmFsc2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMudHJhbnNpdGlvbiA9PSAnc2xpZGUnKSB7XG4gICAgICAgICAgICB0aGlzLiRzbGlkZXNDb250YWluZXIuc3R5bGUud2lkdGggPSAodGhpcy4kJHNsaWRlcy5sZW5ndGggKiAxMDApICsgJyUnO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGk8IHRoaXMuJCRzbGlkZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciAkc2xpZGUgPSA8SFRNTEVsZW1lbnQ+IHRoaXMuJCRzbGlkZXNbaV07XG4gICAgICAgICAgICB2YXIgc2xpZGVEYXRhID0gPFNsaWRlRGF0YT4gJHNsaWRlLmRhdGFzZXQ7XG4gICAgICAgICAgICBzbGlkZURhdGEubnVtID0gKGkrMSkudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICRzbGlkZS5jbGFzc0xpc3QuYWRkKCdzbGlkZS0nICsgKGkrMSkpO1xuXG4gICAgICAgICAgICB2YXIgJGN1cnJlbnREb3QgPSA8SFRNTFNwYW5FbGVtZW50PiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgICAgICAgICB2YXIgY3VycmVudERvdERhdGEgPSA8RG90RGF0YT4gJGN1cnJlbnREb3QuZGF0YXNldDtcbiAgICAgICAgICAgICRjdXJyZW50RG90LmNsYXNzTmFtZSA9ICdkb3QnO1xuICAgICAgICAgICAgY3VycmVudERvdERhdGEubnVtID0gKGkrMSkudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICRjdXJyZW50RG90LmNsYXNzTGlzdC5hZGQoJ3NsaWRlLScgKyAoaSsxKSk7XG5cbiAgICAgICAgICAgICRjdXJyZW50RG90LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5kb3RDbGljaywgZmFsc2UpO1xuICAgICAgICAgICAgaWYgKHRoaXMuJGRvdHNDb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLiRkb3RzQ29udGFpbmVyLmFwcGVuZENoaWxkKCRjdXJyZW50RG90KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLnNldEJhY2tncm91bmQpIHtcbiAgICAgICAgICAgICAgICB2YXIgJGltZyA9IDxIVE1MSW1hZ2VFbGVtZW50PiAkc2xpZGUucXVlcnlTZWxlY3RvcignLnNyYycpO1xuICAgICAgICAgICAgICAgIHZhciBpbWdEYXRhID0gPEltZ0RhdGE+ICRpbWcuZGF0YXNldDtcbiAgICAgICAgICAgICAgICAkc2xpZGUuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gJ3VybCgnICsgJGltZy5zcmMgKyAnKSc7XG4gICAgICAgICAgICAgICAgaW1nRGF0YS5yZWFkeSA9ICRpbWcuY29tcGxldGUgPyAndHJ1ZScgOiAnZmFsc2UnO1xuICAgICAgICAgICAgICAgICRpbWcuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIHRoaXMuaW1nUmVhZHlOb3RpZmljYXRpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5oZWlnaHRHdWFyZCgpO1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy5oZWlnaHRHdWFyZCwgZmFsc2UpO1xuXG4gICAgICAgIGlmICh0aGlzLnNldEJhY2tncm91bmQpIHtcbiAgICAgICAgICAgIHRoaXMuaW1nUmVhZHlXYWl0KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmFsbFJlYWR5ID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuJHNsaWRlci5jbGFzc0xpc3QucmVtb3ZlKCd3YWl0aW5nJyk7XG4gICAgICAgICAgICB0aGlzLiRzbGlkZXIuY2xhc3NMaXN0LmFkZCgncmVhZHknKTtcbiAgICAgICAgICAgIHRoaXMubG9hZFNsaWRlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGhlaWdodEd1YXJkID0gKCkgPT4ge1xuICAgICAgICB2YXIgJHNsaWRlLCBpO1xuICAgICAgICAvLyByZXNldCBtaW5IZWlnaHRcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuJCRzbGlkZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICRzbGlkZSA9IDxIVE1MRWxlbWVudD4gdGhpcy4kJHNsaWRlc1tpXTtcbiAgICAgICAgICAgICRzbGlkZS5zdHlsZS5taW5IZWlnaHQgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY29udGFpbmVySGVpZ2h0ID0gdGhpcy4kc2xpZGVzQ29udGFpbmVyLmNsaWVudEhlaWdodDtcbiAgICAgICAgLy8gc2V0IG1pbkhlaWdodFxuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy4kJHNsaWRlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgJHNsaWRlID0gPEhUTUxFbGVtZW50PiB0aGlzLiQkc2xpZGVzW2ldO1xuICAgICAgICAgICAgJHNsaWRlLnN0eWxlLm1pbkhlaWdodCA9IHRoaXMuY29udGFpbmVySGVpZ2h0ICsgJ3B4JztcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwdWJsaWMgaGFuZGxlSG92ZXIgPSAoZTogRXZlbnQpID0+IHtcbiAgICAgICAgY29uc29sZS5kZWJ1ZygnU2xpZGVyOjpoYW5kbGVIb3ZlcigpJyk7XG4gICAgICAgIC8vZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgLy9lLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgICAgICBpZiAoZS50eXBlID09PSAnbW91c2VvdmVyJykge1xuICAgICAgICAgICAgdGhpcy5hdXRvUHJvZ3Jlc3MgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuYmxvY2tBdXRvUHJvZ3Jlc3MoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZS50eXBlID09PSAnbW91c2VvdXQnKSB7XG4gICAgICAgICAgICB0aGlzLmF1dG9Qcm9ncmVzcyA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnJlc3VtZUF1dG9Qcm9ncmVzcygpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHB1YmxpYyBibG9ja0F1dG9Qcm9ncmVzcyA9ICgpID0+IHtcbiAgICAgICAgY29uc29sZS5kZWJ1ZygnU2xpZGVyOjpibG9ja0F1dG9Qcm9ncmVzcygpJyk7XG4gICAgICAgIGNsZWFyVGltZW91dCh0aGlzLm5leHRTbGlkZVRpbWVvdXQpO1xuICAgICAgICB0aGlzLm5leHRTbGlkZVRpbWVvdXQgPSAwO1xuICAgIH07XG5cbiAgICBwdWJsaWMgcmVzdW1lQXV0b1Byb2dyZXNzID0gKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmRlYnVnKCdTbGlkZXI6OnJlc3VtZUF1dG9Qcm9ncmVzcygpJyk7XG4gICAgICAgIGlmICh0aGlzLmFsbFJlYWR5ICYmIHRoaXMuYXV0b1Byb2dyZXNzKSB7XG4gICAgICAgICAgICB0aGlzLm5leHRTbGlkZVRpbWVvdXQgPSBzZXRUaW1lb3V0KHRoaXMubG9hZFNsaWRlLCB0aGlzLm5leHRTbGlkZURlbGF5KTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBwdWJsaWMgbG9hZFNsaWRlID0gKG51bT86IG51bWJlcikgPT4ge1xuICAgICAgICB0aGlzLmJsb2NrQXV0b1Byb2dyZXNzKCk7XG4gICAgICAgIGlmICghdGhpcy5hbGxSZWFkeSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHZhciAkY3VycmVudCwgY3VycmVudERhdGEsICRuZXh0LCBuZXh0RGF0YSwgY3VycmVudE51bSwgbmV4dE51bSwgJGN1cnJlbnREb3QsICRuZXh0RG90O1xuICAgICAgICAkY3VycmVudCA9IDxIVE1MRWxlbWVudD4gdGhpcy4kc2xpZGVyLnF1ZXJ5U2VsZWN0b3IoJy5zbGlkZS5hY3RpdmUnKTtcblxuICAgICAgICBpZiAoIW51bSkge1xuICAgICAgICAgICAgaWYgKCEkY3VycmVudCkge1xuICAgICAgICAgICAgICAgICRuZXh0ID0gPEhUTUxFbGVtZW50PiB0aGlzLiRzbGlkZXIucXVlcnlTZWxlY3RvcignLnNsaWRlLmluaXRpYWwnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJG5leHQgPSA8SFRNTEVsZW1lbnQ+IHRoaXMuJHNsaWRlci5xdWVyeVNlbGVjdG9yKCcuc2xpZGUuYWN0aXZlICsgLnNsaWRlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoISRuZXh0KSB7XG4gICAgICAgICAgICAgICAgJG5leHQgPSA8SFRNTEVsZW1lbnQ+IHRoaXMuJHNsaWRlci5xdWVyeVNlbGVjdG9yKCcuc2xpZGU6bnRoLWNoaWxkKDEpJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkbmV4dCA9IDxIVE1MRWxlbWVudD4gdGhpcy4kc2xpZGVyLnF1ZXJ5U2VsZWN0b3IoJy5zbGlkZTpudGgtY2hpbGQoJyArIG51bSArICcpJyk7XG4gICAgICAgIH1cbiAgICAgICAgbmV4dERhdGEgPSA8U2xpZGVEYXRhPiAkbmV4dC5kYXRhc2V0O1xuICAgICAgICBpZiAoJGN1cnJlbnQpIHtcbiAgICAgICAgICAgICRjdXJyZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgY3VycmVudERhdGEgPSA8U2xpZGVEYXRhPiAkY3VycmVudC5kYXRhc2V0O1xuICAgICAgICAgICAgY3VycmVudE51bSA9IGN1cnJlbnREYXRhLm51bSB8fCAkY3VycmVudC5jbGFzc05hbWUubWF0Y2goL3NsaWRlLShcXGQrKS8pWzFdO1xuICAgICAgICAgICAgaWYgKHRoaXMuJGRvdHNDb250YWluZXIpIHtcbiAgICAgICAgICAgICAgICAkY3VycmVudERvdCA9IDxIVE1MRWxlbWVudD4gdGhpcy4kZG90c0NvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZG90Om50aC1jaGlsZCgnICsgY3VycmVudE51bSArICcpJyk7XG4gICAgICAgICAgICAgICAgJGN1cnJlbnREb3QuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgJG5leHQuY2xhc3NMaXN0LnJlbW92ZSgnaW5pdGlhbCcpO1xuICAgICAgICAkbmV4dC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcbiAgICAgICAgbmV4dE51bSA9IG5leHREYXRhLm51bSB8fCAkbmV4dC5jbGFzc05hbWUubWF0Y2goL3NsaWRlLShcXGQrKS8pWzFdO1xuICAgICAgICB0aGlzLiRzbGlkZXIuY2xhc3NOYW1lID0gdGhpcy4kc2xpZGVyLmNsYXNzTmFtZS5yZXBsYWNlKC9zbGlkZS0oXFxkKyktYWN0aXZlLywgJycpO1xuICAgICAgICB0aGlzLiRzbGlkZXIuY2xhc3NMaXN0LmFkZCgnc2xpZGUtJyArIG5leHROdW0gKyAnLWFjdGl2ZScpO1xuICAgICAgICBpZiAodGhpcy4kZG90c0NvbnRhaW5lcikge1xuICAgICAgICAgICAgJG5leHREb3QgPSA8SFRNTEVsZW1lbnQ+IHRoaXMuJGRvdHNDb250YWluZXIucXVlcnlTZWxlY3RvcignLmRvdDpudGgtY2hpbGQoJyArIG5leHROdW0gKyAnKScpO1xuICAgICAgICAgICAgJG5leHREb3QuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZXN1bWVBdXRvUHJvZ3Jlc3MoKTtcbiAgICB9O1xuXG4gICAgcHVibGljIGFycm93Q2xpY2sgPSAoZSkgPT4ge1xuICAgICAgICB2YXIgJG5leHQsIG5leHREYXRhLCBudW0sICRhcnJvdyA9IDxIVE1MRWxlbWVudD4gZS50YXJnZXQ7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgaWYgKCRhcnJvdy5jbGFzc0xpc3QuY29udGFpbnMoJ3ByZXYnKSkge1xuICAgICAgICAgICAgJG5leHQgPSA8SFRNTEVsZW1lbnQ+IHRoaXMuJHNsaWRlci5xdWVyeVNlbGVjdG9yKCcuc2xpZGUgKyAuc2xpZGUuYWN0aXZlJyk7XG4gICAgICAgICAgICBpZiAoJG5leHQpIHtcbiAgICAgICAgICAgICAgICAkbmV4dCA9ICRuZXh0LnByZXZpb3VzRWxlbWVudFNpYmxpbmc7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICRuZXh0ID0gPEhUTUxFbGVtZW50PiB0aGlzLiRzbGlkZXIucXVlcnlTZWxlY3RvcignLnNsaWRlOmxhc3Qtb2YtdHlwZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICgkYXJyb3cuY2xhc3NMaXN0LmNvbnRhaW5zKCduZXh0JykpIHtcbiAgICAgICAgICAgICRuZXh0ID0gPEhUTUxFbGVtZW50PiAodGhpcy4kc2xpZGVyLnF1ZXJ5U2VsZWN0b3IoJy5zbGlkZS5hY3RpdmUgKyAuc2xpZGUnKSB8fCB0aGlzLiRzbGlkZXIucXVlcnlTZWxlY3RvcignLnNsaWRlOm50aC1jaGlsZCgxKScpKTtcbiAgICAgICAgfVxuICAgICAgICBuZXh0RGF0YSA9IDxTbGlkZURhdGE+ICRuZXh0LmRhdGFzZXQ7XG4gICAgICAgIG51bSA9IG5leHREYXRhLm51bSB8fCAkbmV4dC5jbGFzc05hbWUubWF0Y2goL3NsaWRlLShcXGQrKS8pWzFdO1xuICAgICAgICB0aGlzLmxvYWRTbGlkZShudW0pO1xuICAgIH07XG5cbiAgICBwdWJsaWMgZG90Q2xpY2sgPSAoZSkgPT4ge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHZhciAkZG90ID0gPEhUTUxFbGVtZW50PiBlLnRhcmdldDtcbiAgICAgICAgdmFyIGRvdERhdGEgPSA8RG90RGF0YT4gJGRvdC5kYXRhc2V0O1xuICAgICAgICB2YXIgbnVtID0gcGFyc2VJbnQoZG90RGF0YS5udW0gfHwgZS50YXJnZXQuY2xhc3NOYW1lLm1hdGNoKC9zbGlkZS0oXFxkKykvKVsxXSk7XG4gICAgICAgIHRoaXMubG9hZFNsaWRlKG51bSk7XG4gICAgfTtcblxuICAgIHB1YmxpYyBpbWdSZWFkeU5vdGlmaWNhdGlvbiA9IChlKSA9PiB7XG4gICAgICAgIHZhciAkaW1nID0gPEhUTUxJbWFnZUVsZW1lbnQ+IGUudGFyZ2V0O1xuICAgICAgICB2YXIgaW1nRGF0YSA9IDxJbWdEYXRhPiAkaW1nLmRhdGFzZXQ7XG4gICAgICAgIGltZ0RhdGEucmVhZHkgPSAndHJ1ZSc7XG4gICAgfTtcblxuICAgIHB1YmxpYyBpbWdSZWFkeVdhaXQgPSAoKSA9PiB7XG4gICAgICAgIHZhciAkJGltZyA9IHRoaXMuJHNsaWRlci5xdWVyeVNlbGVjdG9yQWxsKCcuc2xpZGUgLnNyY1tkYXRhLXJlYWR5PVwiZmFsc2VcIl0nKTtcbiAgICAgICAgaWYgKCQkaW1nLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHNldFRpbWVvdXQodGhpcy5pbWdSZWFkeVdhaXQsIDEwMCk7XG4gICAgICAgICAgICB0aGlzLiRzbGlkZXIuY2xhc3NMaXN0LmFkZCgnd2FpdGluZycpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYWxsUmVhZHkgPSB0cnVlO1xuICAgICAgICB0aGlzLiRzbGlkZXIuY2xhc3NMaXN0LnJlbW92ZSgnd2FpdGluZycpO1xuICAgICAgICB0aGlzLiRzbGlkZXIuY2xhc3NMaXN0LmFkZCgncmVhZHknKTtcbiAgICAgICAgdGhpcy5sb2FkU2xpZGUoKTtcbiAgICB9O1xufVxuIl19